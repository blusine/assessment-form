<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>APRISE Learning â€“ Free Assessment</title>
<style>
  /* Page + container: compact vertical padding */
  body {
    font-family: Arial, sans-serif;
    background-color: #f7f7f7;
    margin: 0;
    padding: 5px 0;                /* reduced top/bottom */
  }
  .container {
    max-width: 700px;
    margin: 0 auto;
    background: #fff;
    padding: 12px 12px;             /* reduced internal padding */
    border-radius: 8px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  }

  /* Section headings (APRISE style) */
  h2.section-title {
    color: #0056A4;                 /* APRISE blue */
    font-size: 18px;
    margin: 12px 0 6px;
    border-bottom: 2px solid #D71920; /* APRISE red underline */
    padding-bottom: 4px;
  }
  .required {
    color: #D71920;
  }

  /* Labels + inputs */
  label {
    display: block;
    font-weight: 700;
    color: #2b2b2b;
    margin: 10px 0 6px;
    font-size: 14px;
  }
  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  select,
  textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 9px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    margin-bottom: 10px;
    background: #fff;
  }
  textarea { resize: vertical; }

  /* Two-up rows with 15px gap */
  .row {
    display: flex;
    flex-wrap: wrap;
  }
  .row .field { flex: 1; min-width: 0; }

  /* Checkbox groups: 2 columns on wide screens, 1 on small */
  .checkbox-group {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    column-gap: 20px;
    row-gap: 6px;                   /* tighter vertical spacing */
    margin: 6px 0 12px;
  }
  @media (max-width: 768px) {
    .checkbox-group { grid-template-columns: 1fr; }
  }
  .checkbox-group label {
    display: flex;
    align-items: flex-start;
    gap: 8px;                       /* space between box and text */
    margin: 0;
    font-weight: 400;
  }

  .secondary-label {
    font-size: 12px;
    color: #666;
    margin: -2px 0 6px;
    font-style: italic;
  }

  /* Time buttons */
  .time-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 6px 0 10px;
  }
  .time-button {
    padding: 8px 12px;
    border: 1px solid #0056A4;
    color: #0056A4;
    background: #fff;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color .18s, color .18s, border-color .18s;
  }
  .time-button:hover,
  .time-button.selected {
    background: #0056A4;
    color: #fff;
  }

  /* Messages + submit */
  .msg {
    font-size: 13px;
    margin-top: 6px;
    display: none;
  }
  .msg.error { color: #b00020; }
  .msg.success { color: #0a7a0a; }

  button[type="submit"] {
    background: #0056A4;            /* APRISE blue */
    color: #fff;
    border: 0;
    border-radius: 4px;
    padding: 10px 18px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 10px;
  }
  button[type="submit"]:hover { background: #003f7d; }
</style>
</head>
<body>

<div class="container">
  <form id="assessmentForm" novalidate>
    <!-- Parent/Guardian Information -->
    <h2 class="section-title">Parent/Guardian Information <span class="required">*</span></h2>
    <div class="row">
      <div class="field">
        <label for="parentFirstName">First Name</label>
        <input type="text" id="parentFirstName" name="parentFirstName" required>
      </div>
      <div class="field">
        <label for="parentLastName">Last Name</label>
        <input type="text" id="parentLastName" name="parentLastName" required>
      </div>
    </div>

    <label for="parentEmail">Email <span class="required">*</span></label>
    <input type="email" id="parentEmail" name="parentEmail" required>

    <label><input type="checkbox" name="newsletter"> Sign up for news and updates</label>

    <label for="parentPhone">Phone <span class="required">*</span></label>
    <input
      type="tel"
      id="parentPhone"
      name="parentPhone"
      inputmode="numeric"
      pattern="\\d{10}"
      placeholder="10-digit number, e.g., 3125551234"
      required
    >
    <div class="msg error" id="phoneError">Please enter a valid 10-digit phone number (numbers only).</div>

    <!-- Student Information -->
    <h2 class="section-title">Student Information <span class="required">*</span></h2>
    <div class="row">
      <div class="field">
        <label for="studentFirstName">First Name</label>
        <input type="text" id="studentFirstName" name="studentFirstName" required>
      </div>
      <div class="field">
        <label for="studentLastName">Last Name</label>
        <input type="text" id="studentLastName" name="studentLastName" required>
      </div>
    </div>

    <label for="studentGrade">Current/Rising Grade or Math Level</label>
    <select id="studentGrade" name="studentGrade" required>
      <option value="">Select an option</option>
      <option>Kindergarten</option>
      <option>Grade 1</option>
      <option>Grade 2</option>
      <option>Grade 3</option>
      <option>Grade 4</option>
      <option>Grade 5</option>
      <option>Grade 6</option>
      <option>Grade 6-8 Pre-Algebra</option>
      <option>Algebra I</option>
      <option>Algebra II</option>
      <option>Geometry</option>
      <option>Precalculus</option>
      <option>Calculus</option>
    </select>

    <!-- Program(s) of Interest -->
    <h2 class="section-title">Program(s) of Interest</h2>
    <!-- <div class="secondary-label">Select all that apply</div> -->
    <div class="checkbox-group" id="programsGroup">
      <label><input type="checkbox" name="programInterest" value="Academic Year Math"> Academic Year Math</label>
      <label><input type="checkbox" name="programInterest" value="Coding (8-16 weeks)"> Coding (8-16 weeks)</label>
      <label><input type="checkbox" name="programInterest" value="Crash Courses (8-16 weeks)"> Crash Courses (8-16 weeks)</label>
      <label><input type="checkbox" name="programInterest" value="Data Science & Optimization (8-16 weeks)"> Data Science & Optimization (8-16 weeks)</label>
      <label><input type="checkbox" name="programInterest" value="Financial Literacy (8-16 weeks)"> Financial Literacy Courses (8-16 weeks)</label>
      <label><input type="checkbox" name="programInterest" value="Individual Tutoring"> Individual Tutoring</label>
      <label><input type="checkbox" name="programInterest" value="Science (8-16 weeks)"> Science (8-16 weeks)</label>
      <label><input type="checkbox" name="programInterest" value="Summer Programs (4-8 weeks)"> Summer Programs (4-8 weeks)</label>
      <label><input type="checkbox" name="programInterest" value="Other"> Other</label>
    </div>
    <div class="msg error" id="programsError">Please select at least one program of interest.</div>

    <!-- How did you hear -->
    <h2 class="section-title">How Did You Hear About Us? <span class="required">*</span></h2>
    <div class="checkbox-group" id="hearGroup">
      <label><input type="checkbox" name="hearAboutUs" value="Recommended by a Friend"> Recommended by a Friend</label>
      <label><input type="checkbox" name="hearAboutUs" value="Social Media"> Facebook, Instagram, YouTube, or LinkedIn</label>
      <label><input type="checkbox" name="hearAboutUs" value="Search Engine"> Search Engine (Google, Bing, or other)</label>
      <label><input type="checkbox" name="hearAboutUs" value="Email from APRISE"> Email from Aprise Learning</label>
      <label><input type="checkbox" name="hearAboutUs" value="School Ads or Email"> School Ads or Email</label>
      <label><input type="checkbox" name="hearAboutUs" value="Other"> Other</label>
    </div>
    <div class="msg error" id="hearError">Please select at least one option.</div>

    <!-- Date & Time -->
    <h2 class="section-title">Preferred Date & Time <span class="required">*</span></h2>
    <label for="preferredDate">Preferred Date</label>
    <input type="date" id="preferredDate" name="preferredDate" required>

    <label>Preferred Time</label>
    <div id="preferredTimeButtons" class="time-buttons"></div>
    <input type="hidden" id="preferredTime" name="preferredTime" required>
    <div class="msg error" id="timeError">Please select a time slot.</div>

    <!-- Notes -->
    <label for="notes">Notes or questions for the teacher</label>
    <textarea id="notes" name="notes" rows="3"></textarea>

    <!-- SMS Consent -->
    <label>
      <input type="checkbox" id="smsConsent" name="smsConsent" required>
      I consent to receive text messages about this session using the phone number provided. <span class="required">*</span>
    </label>
    <div class="msg error" id="smsError">SMS consent is required so we can send reminders for your assessment.</div>

    <!-- Messages + submit -->
    <div class="msg error" id="formError">Please fix the highlighted issues and try again.</div>
    <div class="msg success" id="formSuccess">Thank you! Your free assessment has been scheduled. A confirmation email has been sent.</div>
    <button type="submit">Submit</button>
  </form>
</div>

<script>
  const DEPLOY_URL = "https://script.google.com/macros/s/AKfycbw1JFckUEHppkQ43mYt9UKUAg4BAbClYfWqXyn9N4riSmDGcme20CReZxKvBWvW6dbJew/exec";

  const form = document.getElementById('assessmentForm');
  const programsGroup = document.getElementById('programsGroup');
  const programsError = document.getElementById('programsError');
  const hearGroup = document.getElementById('hearGroup');
  const hearError = document.getElementById('hearError');
  const preferredDate = document.getElementById('preferredDate');
  const preferredTimeButtons = document.getElementById('preferredTimeButtons');
  const preferredTimeInput = document.getElementById('preferredTime');
  const timeError = document.getElementById('timeError');
  const formError = document.getElementById('formError');
  const formSuccess = document.getElementById('formSuccess');
  const phone = document.getElementById('parentPhone');
  const phoneError = document.getElementById('phoneError');
  const email = document.getElementById('parentEmail');
  const smsConsent = document.getElementById('smsConsent');
  const smsError = document.getElementById('smsError');

  // Simple email regex
  function validEmail(value) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
  }

  email.addEventListener('input', () => {
    if (email.value && !validEmail(email.value)) {
      email.setCustomValidity('Please enter a valid email address.');
    } else {
      email.setCustomValidity('');
    }
  });

  phone.addEventListener('input', () => {
    // strip non-digits and enforce 10 digits
    const digits = phone.value.replace(/\D/g, '');
    phoneError.style.display = digits.length === 10 ? 'none' : 'block';
    phone.setCustomValidity(digits.length === 10 ? '' : 'Invalid phone');
  });

  // Load available time slots for the chosen date
  preferredDate.addEventListener('change', async (e) => {
    const date = e.target.value;
    preferredTimeButtons.innerHTML = '';
    preferredTimeInput.value = '';
    timeError.style.display = 'none';
    if (!date) return;

    try {
      const r = await fetch(`${DEPLOY_URL}?date=${encodeURIComponent(date)}`);
      const times = await r.json();
      if (!Array.isArray(times) || times.length === 0) {
        timeError.textContent = "No available times found for this date. Please select another.";
        timeError.style.display = 'block';
        return;
      }
      times.forEach(t => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'time-button';
        btn.textContent = t;
        btn.addEventListener('click', () => {
          document.querySelectorAll('.time-button').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          preferredTimeInput.value = t;
          timeError.style.display = 'none';
        });
        preferredTimeButtons.appendChild(btn);
      });
    } catch (err) {
      console.error(err);
      timeError.textContent = "Couldn't load time slots. Please try another date.";
      timeError.style.display = 'block';
    }
  });

  function atLeastOneChecked(container) {
    return !!container.querySelector('input[type="checkbox"]:checked');
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    formError.style.display = 'none';
    formSuccess.style.display = 'none';
    programsError.style.display = 'none';
    hearError.style.display = 'none';
    timeError.style.display = 'none';
    smsError.style.display = 'none';

    // Built-in required checks
    if (!form.checkValidity()) {
      formError.style.display = 'block';
      return;
    }
    // Custom checks
    if (!atLeastOneChecked(programsGroup)) {
      programsError.style.display = 'block';
      return;
    }
    if (!atLeastOneChecked(hearGroup)) {
      hearError.style.display = 'block';
      return;
    }
    if (!preferredTimeInput.value) {
      timeError.style.display = 'block';
      return;
    }
    if (!smsConsent.checked) {
      smsError.style.display = 'block';
      return;
    }

    // Build payload for Apps Script
    const fd = new FormData(form);
    const data = {
      parentFirstName: fd.get('parentFirstName'),
      parentLastName:  fd.get('parentLastName'),
      parentEmail:     fd.get('parentEmail'),
      parentPhone:     fd.get('parentPhone').replace(/\D/g, ''), // digits only
      studentFirstName:fd.get('studentFirstName'),
      studentLastName: fd.get('studentLastName'),
      studentGrade:    fd.get('studentGrade'),
      programInterest: Array.from(programsGroup.querySelectorAll('input[type="checkbox"]:checked')).map(i => i.value),
      preferredDate:   fd.get('preferredDate'),
      preferredTime:   fd.get('preferredTime'),
      hearAboutUs:     Array.from(hearGroup.querySelectorAll('input[type="checkbox"]:checked')).map(i => i.value),
      notes:           fd.get('notes') || '',
      smsConsent:      true
    };

    try {
      const res = await fetch(DEPLOY_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error(`Server error: ${res.status}`);
      await res.json().catch(() => ({}));

      // Success UI
      form.reset();
      preferredTimeButtons.innerHTML = '';
      formSuccess.style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } catch (err) {
      console.error(err);
      formError.textContent = "There was a problem submitting the form. Please try again.";
      formError.style.display = 'block';
    }
  });
</script>
</body>
</html>
