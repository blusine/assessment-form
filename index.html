<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <base target="_top">
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      background-color: #FEF8F8;
      color: #000000;
      font-size: 15px;
    }
    h2 {
      font-family: 'Proxima Nova', sans-serif;
      color: #00699C;
    }
    form {
      display: flex;
      flex-direction: column;
    }
    label {
      margin-top: 12px;
      font-weight: 600;
    }
    input, select, textarea, button {
      padding: 10px;
      margin-top: 4px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
    }
    select[multiple] {
      height: 200px;
    }
    button {
      background-color: #FF7043;
      color: #FFFFFF;
      border: none;
      margin-top: 20px;
      cursor: pointer;
      border-radius: 4px;
      font-family: 'Proxima Nova', sans-serif;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #e85c30;
    }
    .confirmation {
      text-align: center;
      font-family: 'Proxima Nova', sans-serif;
      font-size: 1.2em;
      margin-top: 40px;
      color: #00699C;
    }
    #timeError {
      color: red;
      margin-top: 6px;
      display: none;
    }
    .time-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .time-button {
      flex: 1 0 auto;
      padding: 10px;
      background-color: #eee;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
    }
    .time-button.selected {
      background-color: #00699C;
      color: #fff;
    }
    .checkbox-group label {
      display: block;
      margin-bottom: 6px;
    }
    .secondary-label {
      font-weight: normal;
      font-size: 0.9em;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <h2>Book a Free Assessment</h2>
  <p><span style="color:red">*</span> Required fields</p>
  <form id="assessmentForm" novalidate>
    <label>Parent First Name<span style="color:red">*</span><input name="parentFirstName" required></label>
    <label>Parent Last Name<span style="color:red">*</span><input name="parentLastName" required></label>
    <label>Parent Email<span style="color:red">*</span><input type="email" name="parentEmail" required></label>
    <label>Parent Phone<span style="color:red">*</span><input name="parentPhone" pattern="\d{10}" placeholder="e.g. 3125551234" required></label>

    <label>Student First Name<span style="color:red">*</span><input name="studentFirstName" required></label>
    <label>Student Last Name<span style="color:red">*</span><input name="studentLastName" required></label>
    <label>Current/Rising Grade or Math Level<span style="color:red">*</span>
      <select name="studentGrade" required>
        <option value="">Select grade</option>
        <option>Kindergarten</option>
        <option>Grade 1</option>
        <option>Grade 2</option>
        <option>Grade 3</option>
        <option>Grade 4</option>
        <option>Grade 5</option>
        <option>Grade 6</option>
        <option>Grade 6-8 Pre-Algebra</option>
        <option>Algebra I</option>
        <option>Algebra II</option>
        <option>Geometry</option>
        <option>Pre-Calculus</option>
        <option>Calculus</option>
      </select>
    </label>

    <label>Program(s) of Interest<span style="color:red">*</span></label>
    <div class="secondary-label">(You may select more than one option)</div>
    <select name="programInterest" multiple required>
      <option>Academic Year Math</option>
      <option>Coding (8 to 16 weeks)</option>
      <option>Science (8 to 16 weeks)</option>
      <option>Financial Literacy (8 to 16 weeks)</option>
      <option>Data Science & Optimization (8 to 16 weeks)</option>
      <option>Individual Tutoring</option>
      <option>Crash Courses (8 to 16 weeks)</option>
      <option>Summer Programs (4 to 8 weeks)</option>
    </select>

    <label>Preferred Date<span style="color:red">*</span><input type="date" name="preferredDate" id="preferredDate" required></label>
    <label>Preferred Time<span style="color:red">*</span></label>
    <div id="preferredTimeButtons" class="time-buttons"></div>
    <input type="hidden" name="preferredTime" id="preferredTime" required>
    <div id="timeError"></div>

    <label>How did you Hear About APRISE Learning?<span style="color:red">*</span></label>
    <div class="checkbox-group">
      <label><input type="checkbox" name="hearAboutUs" value="Friend" required> Recommended by a Friend</label>
      <label><input type="checkbox" name="hearAboutUs" value="Social Media"> Social Media (Facebook/Instagram/Youtube/LinkedIn)</label>
      <label><input type="checkbox" name="hearAboutUs" value="Search Engine"> Search Engine (Google, Bing, or other)</label>
      <label><input type="checkbox" name="hearAboutUs" value="Email from APRISE"> Email from APRISE Learning</label>
      <label><input type="checkbox" name="hearAboutUs" value="Email from School"> Email from School</label>
      <label><input type="checkbox" name="hearAboutUs" value="Other"> Otherâ€¦</label>
    </div>

    <label>Notes or questions for the teacher<textarea name="notes"></textarea></label>

    <label>
      <input type="checkbox" name="smsConsent" required>
      I consent to receive text messages about this session using the phone number provided.<span style="color:red">*</span>
    </label>

    <button type="submit">Submit</button>
  </form>

  <div class="confirmation" id="confirmation" style="display: none;">
    <p>Thank you! Your free assessment has been scheduled. A confirmation email has been sent.</p>
  </div>

  <script>
    const form = document.getElementById('assessmentForm');
    const confirmation = document.getElementById('confirmation');
    const timeError = document.getElementById('timeError');
    const preferredTimeInput = document.getElementById('preferredTime');
    const preferredTimeButtons = document.getElementById('preferredTimeButtons');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!form.checkValidity()) {
        alert("Please fill out all required fields correctly.");
        return;
      }

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      data.smsConsent = !!form.smsConsent.checked;
      data.programInterest = formData.getAll("programInterest");
      data.hearAboutUs = formData.getAll("hearAboutUs");

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbw1JFckUEHppkQ43mYt9UKUAg4BAbClYfWqXyn9N4riSmDGcme20CReZxKvBWvW6dbJew/exec", {
          method: "POST",
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          form.style.display = 'none';
          confirmation.style.display = 'block';
        } else {
          alert("There was an error submitting the form. Please try again.");
        }
      } catch (error) {
        console.error("Submission error:", error);
        alert("Network error. Please check your connection and try again.");
      }
    });

    document.getElementById('preferredDate').addEventListener('change', async (e) => {
      const date = e.target.value;
      preferredTimeButtons.innerHTML = '';
      preferredTimeInput.value = '';
      timeError.style.display = 'none';

      if (!date) return;

      try {
        const response = await fetch(`https://script.google.com/macros/s/AKfycbw1JFckUEHppkQ43mYt9UKUAg4BAbClYfWqXyn9N4riSmDGcme20CReZxKvBWvW6dbJew/exec?date=${date}`);
        const times = await response.json();

        if (times.length === 0) {
          timeError.textContent = "No available times found for this date. Please select another.";
          timeError.style.display = 'block';
        } else {
          times.forEach(time => {
            const btn = document.createElement('div');
            btn.className = 'time-button';
            btn.textContent = time;
            btn.addEventListener('click', () => {
              document.querySelectorAll('.time-button').forEach(b => b.classList.remove('selected'));
              btn.classList.add('selected');
              preferredTimeInput.value = time;
              timeError.style.display = 'none';
            });
            preferredTimeButtons.appendChild(btn);
          });
        }
      } catch (err) {
        console.error("Error fetching available times:", err);
        timeError.textContent = "Unable to load time slots. Please try another date.";
        timeError.style.display = 'block';
      }
    });
  </script>
</body>
</html>
